<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>files</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <!--CSS-->
    <link href="css/index.css" rel="stylesheet">
</head>
<body>
    <div class="topnav">
        <a href="index.html">Home</a>
        <a href="page2.html">Pagina 2</a>
        <a class="active" href="docs.html">Docs</a>
    </div>
    <br>
    <h2>Files/</h2>
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Dimensione</th>
                <th>Ultima Modifica</th>
            </tr>
        </thead>
        <tbody id="fileTable">
            <!-- I dati verranno inseriti qui con JavaScript -->
        </tbody>
    </table>

    <script>
        const owner = "mattiacot";  // Sostituisci con il tuo username GitHub
        const repo = "website";      // Sostituisci con il nome della tua repository
        const path = "files";          // Percorso della cartella da leggere
        const branch = "main";         // Branch principale (es. "main" o "master")

        async function fetchLastModified(filePath) {
            const commitsUrl = `https://api.github.com/repos/${owner}/${repo}/commits?path=${filePath}&sha=${branch}`;
            const commitsResponse = await fetch(commitsUrl);
            const commits = await commitsResponse.json();
            return commits.length > 0 ? new Date(commits[0].commit.author.date).toLocaleString() : "Data non disponibile";
        }

        async function loadFiles() {
            const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
            const response = await fetch(apiUrl);
            const files = await response.json();
            const tableBody = document.getElementById("fileTable");

            tableBody.innerHTML = ""; // Pulisce la tabella

            for (const file of files) {
                const row = document.createElement("tr");

                const nameCell = document.createElement("td");
                const link = document.createElement("a");
                link.href = file.download_url || `https://github.com/${owner}/${repo}/tree/${branch}/${file.path}`;
                link.textContent = file.name;
                nameCell.appendChild(link);

                const sizeCell = document.createElement("td");
                sizeCell.textContent = file.size ? `${(file.size / 1024).toFixed(2)} KB` : "Cartella";

                const dateCell = document.createElement("td");
                dateCell.textContent = "Caricamento...";

                row.appendChild(nameCell);
                row.appendChild(sizeCell);
                row.appendChild(dateCell);
                tableBody.appendChild(row);

                // Recupera la data di modifica e aggiorna la cella
                dateCell.textContent = await fetchLastModified(file.path);
            }
        }

        loadFiles();
    </script>

</body>
</html>

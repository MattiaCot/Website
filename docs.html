<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>files</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link href="css/index.css" rel="stylesheet">
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            border-bottom: 1px solid #555;
            text-align: left;
        }
        th {
            font-weight: bold;
        }
        a {
            color: lightblue;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .folder::before {
            content: "üìÅ ";
        }
        .file::before {
            content: "üìÑ ";
        }
        .back-link {
            display: block;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="topnav">
        <a href="index.html">Home</a>
        <a href="page2.html">Pagina 2</a>
        <a class="active" href="docs.html">Docs</a>
    </div>
    <br>
    <h2 id="currentPath">[cartella radice]</h2>
    <a class="back-link" id="backButton" style="display: none; cursor: pointer; color: lightblue;">‚¨Ö Torna indietro</a>
    
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Dimensione</th>
                <th>Ultima modifica</th>
            </tr>
        </thead>
        <tbody id="fileTable">
        </tbody>
    </table>

    <script>
        const owner = "mattiacot";
        const repo = "website";
        const branch = "main";
        let currentPath = "files";

        async function fetchLastModified(filePath) {
            const commitsUrl = `https://api.github.com/repos/${owner}/${repo}/commits?path=${filePath}&sha=${branch}`;
            const commitsResponse = await fetch(commitsUrl);
            const commits = await commitsResponse.json();
            return commits.length > 0 ? new Date(commits[0].commit.author.date).toLocaleString() : "Data non disponibile";
        }

        async function loadFiles(path) {
            const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
            const response = await fetch(apiUrl);
            const files = await response.json();
            const tableBody = document.getElementById("fileTable");
            const backButton = document.getElementById("backButton");
            const currentPathDisplay = document.getElementById("currentPath");

            tableBody.innerHTML = "";
            currentPathDisplay.innerHTML = `[cartella radice] ${path}`;
            currentPath = path;

            if (path !== "files") {
                backButton.style.display = "block";
                backButton.onclick = () => goBack();
            } else {
                backButton.style.display = "none";
            }

            for (const file of files) {
                const row = document.createElement("tr");
                const nameCell = document.createElement("td");
                const link = document.createElement("a");
                link.textContent = file.name;

                if (file.type === "dir") {
                    link.href = "#";
                    link.classList.add("folder");
                    link.onclick = () => loadFiles(file.path);
                } else {
                    link.href = file.download_url;
                    link.target = "_blank";
                    link.classList.add("file");
                }
                nameCell.appendChild(link);

                const sizeCell = document.createElement("td");
                sizeCell.textContent = file.size ? `${(file.size / 1024).toFixed(1)} kB` : "Cartella";

                const dateCell = document.createElement("td");
                dateCell.textContent = "Caricamento...";

                row.appendChild(nameCell);
                row.appendChild(sizeCell);
                row.appendChild(dateCell);
                tableBody.appendChild(row);

                dateCell.textContent = await fetchLastModified(file.path);
            }
        }

        function goBack() {
            let parts = currentPath.split("/");
            parts.pop();
            loadFiles(parts.join("/") || "files");
        }

        loadFiles(currentPath);
    </script>
</body>
</html>

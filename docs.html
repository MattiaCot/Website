<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>files</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <!--CSS-->
    <link href="css/index.css" rel="stylesheet">
</head>
<body>
    <div class="topnav">
        <a href="index.html">Home</a>
        <a href="page2.html">Pagina 2</a>
        <a class="active" href="docs.html">Docs</a>
    </div>
    <br>
    <h2 id="currentPath">Files/</h2>
    <a class="back-link" id="backButton" style="display: none; cursor: pointer; color: blue;">â¬… Torna indietro</a>
    
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Dimensione</th>
                <th>Ultima Modifica</th>
            </tr>
        </thead>
        <tbody id="fileTable">
            <!-- I dati verranno inseriti qui con JavaScript -->
        </tbody>
    </table>

    <script>
        const owner = "owner";  // Sostituisci con il tuo username GitHub 
        const repo = "repo";      // Sostituisci con il nome della tua repository 
        const branch = "main";   // Branch principale (es. "main" o "master")
        let currentPath = "files"; // Percorso iniziale

        async function fetchLastModified(filePath) {
            const commitsUrl = `https://api.github.com/repos/${owner}/${repo}/commits?path=${filePath}&sha=${branch}`;
            const commitsResponse = await fetch(commitsUrl);
            const commits = await commitsResponse.json();
            return commits.length > 0 ? new Date(commits[0].commit.author.date).toLocaleString() : "Data non disponibile";
        }

        async function loadFiles(path) {
            const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
            const response = await fetch(apiUrl);
            const files = await response.json();
            const tableBody = document.getElementById("fileTable");
            const backButton = document.getElementById("backButton");
            const currentPathDisplay = document.getElementById("currentPath");

            tableBody.innerHTML = ""; // Pulisce la tabella
            currentPathDisplay.innerHTML = `ðŸ“‚ <strong>${path}</strong>`; // Mostra il percorso corrente
            currentPath = path;

            if (path !== "files") {
                backButton.style.display = "block";
                backButton.onclick = () => goBack();
            } else {
                backButton.style.display = "none";
            }

            for (const file of files) {
                const row = document.createElement("tr");

                const nameCell = document.createElement("td");
                const link = document.createElement("a");
                link.textContent = file.name;

                if (file.type === "dir") {
                    link.href = "#";
                    link.style.color = "blue";
                    link.onclick = () => loadFiles(file.path);
                } else {
                    link.href = file.download_url;
                    link.target = "_blank";
                }

                nameCell.appendChild(link);
                
                const sizeCell = document.createElement("td");
                sizeCell.textContent = file.size ? `${(file.size / 1024).toFixed(2)} KB` : "Cartella";

                const dateCell = document.createElement("td");
                dateCell.textContent = "Caricamento...";

                row.appendChild(nameCell);
                row.appendChild(sizeCell);
                row.appendChild(dateCell);
                tableBody.appendChild(row);

                dateCell.textContent = await fetchLastModified(file.path);
            }
        }

        function goBack() {
            let parts = currentPath.split("/");
            parts.pop();
            loadFiles(parts.join("/") || "files");
        }

        loadFiles(currentPath);
    </script>
</body>
</html>